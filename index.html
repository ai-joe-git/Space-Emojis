<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Rocket Adventure</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #gameCanvas {
            display: block;
        }
        #menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-family: Arial, sans-serif;
            color: white;
        }
        #highScores {
            margin-top: 20px;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
        #audioControls {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="menu">
        <h1>Space Rocket Adventure</h1>
        <button id="startButton">Start Game</button>
        <button id="restartButton" style="display: none;">Restart</button>
        <button id="shareButton" style="display: none;">Share Score</button>
        <div id="highScores"></div>
    </div>
    <div id="audioControls">
        <label><input type="checkbox" id="musicToggle" checked> Music</label>
        <label><input type="checkbox" id="sfxToggle" checked> Sound Effects</label>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menu = document.getElementById('menu');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const shareButton = document.getElementById('shareButton');
        const highScoresDiv = document.getElementById('highScores');
        const musicToggle = document.getElementById('musicToggle');
        const sfxToggle = document.getElementById('sfxToggle');

        let canvasWidth = window.innerWidth;
        let canvasHeight = window.innerHeight;
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        let rocket = {
            x: 50,
            y: canvasHeight / 2,
            width: 40,
            height: 20,
            velocity: 0,
            flameActive: false
        };

        let enemies = [];
        let powerUps = [];
        let stars = [];
        let particles = [];
        let score = 0;
        let highScores = [];
        let gameState = 'menu';
        let activePowerUp = null;
        let powerUpTimer = 0;
        let gameTime = 0;

        const backgroundMusic = new Audio('https://example.com/background-music.mp3');
        backgroundMusic.loop = true;
        const powerUpSound = new Audio('https://example.com/powerup-sound.mp3');
        const flameSound = new Audio('https://example.com/flame-sound.mp3');
        flameSound.loop = true;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvasWidth = canvas.width;
            canvasHeight = canvas.height;
            
            // Update rocket position
            if (rocket) {
                rocket.y = canvasHeight / 2;
            }
            
            // Redraw the game if it's already started
            if (gameState === 'playing') {
                draw();
            }
        }

        window.addEventListener('resize', resizeCanvas);

        function toggleMusic() {
            if (musicToggle.checked) {
                backgroundMusic.play();
            } else {
                backgroundMusic.pause();
            }
        }

        function playSoundEffect(sound) {
            if (sfxToggle.checked) {
                sound.play();
            }
        }

        function createStar() {
            stars.push({
                x: canvasWidth,
                y: Math.random() * canvasHeight,
                size: Math.random() * 2 + 1,
                speed: Math.random() * 3 + 1
            });
        }

        function createEnemy() {
            enemies.push({
                x: canvasWidth,
                y: Math.random() * (canvasHeight - 20),
                width: 20,
                height: 20,
                speed: Math.random() * 2 + 1
            });
        }

        function createPowerUp() {
            powerUps.push({
                x: canvasWidth,
                y: Math.random() * (canvasHeight - 15),
                width: 15,
                height: 15,
                speed: 2,
                type: Math.random() < 0.5 ? 'invincibility' : 'scoreMultiplier'
            });
        }

        function createParticle(x, y, color) {
            particles.push({
                x: x,
                y: y,
                size: Math.random() * 3 + 1,
                color: color,
                speedX: (Math.random() - 0.5) * 5,
                speedY: (Math.random() - 0.5) * 5,
                life: 30
            });
        }

        function drawRocket() {
            ctx.fillStyle = '#FFA500';
            ctx.fillRect(rocket.x, rocket.y, rocket.width, rocket.height);

            if (rocket.flameActive) {
                ctx.beginPath();
                ctx.moveTo(rocket.x, rocket.y + 5);
                ctx.lineTo(rocket.x - 15, rocket.y + rocket.height / 2);
                ctx.lineTo(rocket.x, rocket.y + rocket.height - 5);
                ctx.fillStyle = 'red';
                ctx.fill();
            }
        }

        function drawEnemies() {
            ctx.fillStyle = 'red';
            enemies.forEach(enemy => {
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });
        }

        function drawPowerUps() {
            powerUps.forEach(powerUp => {
                ctx.fillStyle = powerUp.type === 'invincibility' ? 'gold' : 'purple';
                ctx.fillRect(powerUp.x, powerUp.y, powerUp.width, powerUp.height);
            });
        }

        function drawStars() {
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawParticles() {
            particles.forEach(particle => {
                ctx.fillStyle = `rgba(${particle.color[0]}, ${particle.color[1]}, ${particle.color[2]}, ${particle.life / 30})`;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawScore() {
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);
        }

        function drawActivePowerUp() {
            if (activePowerUp) {
                ctx.fillStyle = 'white';
                ctx.font = '16px Arial';
                ctx.fillText(`${activePowerUp} active!`, 10, 60);
            }
        }

        function update() {
            gameTime++;

            if (rocket.flameActive) {
                rocket.velocity -= 0.5;
                playSoundEffect(flameSound);
            } else {
                rocket.velocity += 0.3;
                flameSound.pause();
            }

            rocket.y += rocket.velocity;

            if (rocket.y < 0) {
                rocket.y = 0;
                rocket.velocity = 0;
            } else if (rocket.y + rocket.height > canvasHeight) {
                rocket.y = canvasHeight - rocket.height;
                rocket.velocity = 0;
            }

            stars.forEach(star => {
                star.x -= star.speed;
            });

            stars = stars.filter(star => star.x > 0);

            enemies.forEach(enemy => {
                enemy.x -= enemy.speed;
            });

            enemies = enemies.filter(enemy => enemy.x + enemy.width > 0);

            powerUps.forEach(powerUp => {
                powerUp.x -= powerUp.speed;
            });

            powerUps = powerUps.filter(powerUp => powerUp.x + powerUp.width > 0);

            particles.forEach(particle => {
                particle.x += particle.speedX;
                particle.y += particle.speedY;
                particle.life--;
            });

            particles = particles.filter(particle => particle.life > 0);

            if (activePowerUp) {
                powerUpTimer--;
                if (powerUpTimer <= 0) {
                    activePowerUp = null;
                }
            }

            const hitbox = {
                x: rocket.x + 5,
                y: rocket.y + 5,
                width: rocket.width - 10,
                height: rocket.height - 10
            };

            for (let i = enemies.length - 1; i >= 0; i--) {
                if (
                    hitbox.x < enemies[i].x + enemies[i].width &&
                    hitbox.x + hitbox.width > enemies[i].x &&
                    hitbox.y < enemies[i].y + enemies[i].height &&
                    hitbox.y + hitbox.height > enemies[i].y
                ) {
                    if (activePowerUp !== 'invincibility') {
                        gameOver();
                        return;
                    } else {
                        enemies.splice(i, 1);
                        score += 20;
                        for (let j = 0; j < 20; j++) {
                            createParticle(enemies[i].x, enemies[i].y, [255, 0, 0]);
                        }
                    }
                }
            }

            for (let i = powerUps.length - 1; i >= 0; i--) {
                if (
                    hitbox.x < powerUps[i].x + powerUps[i].width &&
                    hitbox.x + hitbox.width > powerUps[i].x &&
                    hitbox.y < powerUps[i].y + powerUps[i].height &&
                    hitbox.y + hitbox.height > powerUps[i].y
                ) {
                    activePowerUp = powerUps[i].type;
                    powerUpTimer = 300;
                    powerUps.splice(i, 1);
                    playSoundEffect(powerUpSound);
                    score += 50;
                }
            }

            particles.forEach(particle => {
                enemies.forEach((enemy, index) => {
                    if (Math.abs(enemy.x - particle.x) < 15 && Math.abs(enemy.y - particle.y) < 15) {
                        enemies.splice(index, 1);
                        score += 10;
                        for (let i = 0; i < 20; i++) {
                            createParticle(enemy.x, enemy.y, [255, 0, 0]);
                        }
                    }
                });
            });

            if (Math.random() < 0.02) createEnemy();
            if (Math.random() < 0.005) createPowerUp();
            if (Math.random() < 0.1) createStar();

            score++;
        }

        function draw() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            const skyBlue = [135, 206, 235];
            const spaceBlue = [0, 0, 50];
            const transitionProgress = Math.min(gameTime / (30 * 60), 1);

            const r = Math.floor(skyBlue[0] + (spaceBlue[0] - skyBlue[0]) * transitionProgress);
            const g = Math.floor(skyBlue[1] + (spaceBlue[1] - skyBlue[1]) * transitionProgress);
            const b = Math.floor(skyBlue[2] + (spaceBlue[2] - skyBlue[2]) * transitionProgress);

            const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            gradient.addColorStop(0, `rgb(${r}, ${g}, ${b})`);
            gradient.addColorStop(1, `rgb(${Math.max(0, r-20)}, ${Math.max(0, g-20)}, ${Math.max(0, b-20)})`);

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            drawStars();
            drawRocket();
            drawEnemies();
            drawPowerUps();
            drawParticles();
            drawScore();
            drawActivePowerUp();
        }

        function gameLoop() {
            if (gameState === 'playing') {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        function resetGame() {
            rocket.y = canvasHeight / 2;
            rocket.velocity = 0;
            enemies.length = 0;
            powerUps.length = 0;
            stars.length = 0;
            particles.length = 0;
            score = 0;
            activePowerUp = null;
            powerUpTimer = 0;
            gameTime = 0;
        }

        function gameOver() {
            gameState = 'menu';
            menu.style.display = 'block';
            startButton.style.display = 'none';
            restartButton.style.display = 'inline-block';
            shareButton.style.display = 'inline-block';
            updateHighScores();
            displayHighScores();
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
        }

        function handleInput(e) {
            if (e.type === 'keydown' && e.code === 'Space' || e.type === 'touchstart') {
                rocket.flameActive = true;
            } else if (e.type === 'keyup' && e.code === 'Space' || e.type === 'touchend') {
                rocket.flameActive = false;
            }
        }

        function startGame() {
            gameState = 'playing';
            menu.style.display = 'none';
            resetGame();
            toggleMusic();
            gameLoop();
        }

        function updateHighScores() {
            highScores.push(score);
            highScores.sort((a, b) => b - a);
            highScores = highScores.slice(0, 5);
        }

        function displayHighScores() {
            highScoresDiv.innerHTML = '<h2>High Scores</h2>';
            highScores.forEach((score, index) => {
                highScoresDiv.innerHTML += `<p>${index + 1}. ${score}</p>`;
            });
        }

        function shareScore() {
            const shareCanvas = document.createElement('canvas');
            shareCanvas.width = canvasWidth;
            shareCanvas.height = canvasHeight + 50;
            const shareCtx = shareCanvas.getContext('2d');

            shareCtx.drawImage(canvas, 0, 0);
            shareCtx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            shareCtx.fillRect(0, canvasHeight, canvasWidth, 50);
            shareCtx.fillStyle = 'white';
            shareCtx.font = '20px Arial';
            shareCtx.textAlign = 'center';
            shareCtx.fillText(`Score: ${score}`, canvasWidth / 2, canvasHeight + 30);

            shareCanvas.toBlob(function(blob) {
                const file = new File([blob], "space-rocket-score.png", { type: "image/png" });
                const filesArray = [file];
                
                if (navigator.share && navigator.canShare({ files: filesArray })) {
                    navigator.share({
                        files: filesArray,
                        title: 'Space Rocket Adventure Score',
                        text: `I scored ${score} points in Space Rocket Adventure!`
                    }).then(() => console.log('Share was successful.'))
                    .catch((error) => console.log('Sharing failed', error));
                } else {
                    console.log("Web Share API is not supported in your browser.");
                    // Fallback: You could implement a different sharing method here
                }
            });
        }

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        shareButton.addEventListener('click', shareScore);
        musicToggle.addEventListener('change', toggleMusic);

        window.addEventListener('keydown', handleInput);
        window.addEventListener('keyup', handleInput);
        canvas.addEventListener('touchstart', handleInput);
        canvas.addEventListener('touchend', handleInput);

        displayHighScores();
    </script>
</body>
</html>