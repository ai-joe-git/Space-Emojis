<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jetpack Emoji Adventure</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #87CEEB;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #gameCanvas {
            border: 2px solid #000;
        }
        #gameOver, #startScreen {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 24px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
        }
        button {
            font-size: 18px;
            padding: 10px 20px;
            margin-top: 20px;
            cursor: pointer;
        }
        .emoji {
            font-size: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #socialShare {
            margin-top: 20px;
        }
        .shareButton {
            margin: 0 10px;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="startScreen">
        <h1>Jetpack Emoji Adventure</h1>
        <p>Tap or click to use jetpack and avoid enemies!</p>
        <button id="startButton">Start Game</button>
    </div>
    <div id="gameOver">
        <h2>Game Over!</h2>
        <p>Score: <span id="finalScore"></span></p>
        <p>High Score: <span id="highScore"></span></p>
        <button id="restartButton">Restart</button>
        <div id="socialShare">
            <span class="shareButton" onclick="shareScore('twitter')">üê¶</span>
            <span class="shareButton" onclick="shareScore('facebook')">üìò</span>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameOverScreen = document.getElementById('gameOver');
        const startScreen = document.getElementById('startScreen');
        const finalScoreSpan = document.getElementById('finalScore');
        const highScoreSpan = document.getElementById('highScore');
        const restartButton = document.getElementById('restartButton');
        const startButton = document.getElementById('startButton');

        canvas.width = window.innerWidth - 20;
        canvas.height = window.innerHeight - 20;

        let player, enemies, boss, powerUps;
        let score = 0;
        let highScore = 0;
        let level = 1;
        let fuel = 100;
        let isBossLevel = false;
        let isGameRunning = false;
        let isJetpackActive = false;

        function safeGetItem(key, fallback) {
            try {
                const value = localStorage.getItem(key);
                return value !== null ? value : fallback;
            } catch (e) {
                console.warn("localStorage is not available. Using fallback value.");
                return fallback;
            }
        }

        function safeSetItem(key, value) {
            try {
                localStorage.setItem(key, value);
            } catch (e) {
                console.warn("localStorage is not available. Unable to save data.");
            }
        }

        highScore = parseInt(safeGetItem('highScore', '0'), 10);

        class GameObject {
            constructor(x, y, emoji, size) {
                this.x = x;
                this.y = y;
                this.emoji = emoji;
                this.size = size;
            }

            draw() {
                ctx.font = `${this.size}px Arial`;
                ctx.fillText(this.emoji, this.x, this.y);
            }

            collision(other) {
                return Math.abs(this.x - other.x) < this.size / 2 + other.size / 2 &&
                       Math.abs(this.y - other.y) < this.size / 2 + other.size / 2;
            }
        }

        class Player extends GameObject {
            constructor() {
                super(50, canvas.height / 2, 'üöÄ', 40);
                this.vy = 0;
                this.powerUp = null;
                this.powerUpTimer = 0;
            }

            update() {
                if (isJetpackActive && fuel > 0) {
                    this.vy -= 0.5;
                    fuel -= 0.5;
                } else {
                    this.vy += 0.3;
                }

                this.vy = Math.max(-5, Math.min(5, this.vy));
                this.y += this.vy;
                
                if (this.y < 0) this.y = 0;
                if (this.y > canvas.height) this.y = canvas.height;

                if (this.powerUp && this.powerUpTimer > 0) {
                    this.powerUpTimer--;
                } else if (this.powerUpTimer <= 0) {
                    this.powerUp = null;
                }
            }

            shoot() {
                if (this.powerUp) {
                    return new GameObject(this.x + this.size, this.y, this.powerUp, 20);
                }
                return null;
            }
        }

        class Enemy extends GameObject {
            constructor() {
                const types = ['üëæ', 'üëª', 'ü¶π'];
                super(canvas.width, Math.random() * canvas.height, types[Math.floor(Math.random() * types.length)], 30);
                this.vx = -2 - Math.random() * 2;
                this.vy = Math.random() * 2 - 1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }
        }

        class Boss extends GameObject {
            constructor() {
                const types = ['üëπ', 'üêâ', 'ü¶ë'];
                super(canvas.width - 100, canvas.height / 2, types[Math.floor(Math.random() * types.length)], 60);
                this.health = 100;
                this.attackTimer = 0;
                this.attackPattern = Math.floor(Math.random() * 3);
            }

            update() {
                this.attackTimer++;
                if (this.attackTimer >= 60) {
                    this.attackTimer = 0;
                    return this.attack();
                }
                return null;
            }

            attack() {
                switch(this.attackPattern) {
                    case 0: // Single shot
                        return new GameObject(this.x - this.size, this.y, 'üî•', 20);
                    case 1: // Triple shot
                        return [
                            new GameObject(this.x - this.size, this.y - 30, 'üî•', 20),
                            new GameObject(this.x - this.size, this.y, 'üî•', 20),
                            new GameObject(this.x - this.size, this.y + 30, 'üî•', 20)
                        ];
                    case 2: // Homing missile
                        return new GameObject(this.x - this.size, this.y, 'üöÄ', 20);
                }
            }
        }

        class PowerUp extends GameObject {
            constructor() {
                const powerUps = ['üî´', '‚ùÑÔ∏è', 'üî•', 'üõ°Ô∏è', '‚ö°'];
                super(canvas.width, Math.random() * canvas.height, powerUps[Math.floor(Math.random() * powerUps.length)], 30);
                this.vx = -1;
            }

            update() {
                this.x += this.vx;
            }
        }

        function init() {
            player = new Player();
            enemies = [];
            powerUps = [];
            boss = null;
            score = 0;
            level = 1;
            fuel = 100;
            isBossLevel = false;
        }

        function update() {
            player.update();

            if (!isBossLevel) {
                if (Math.random() < 0.02) {
                    enemies.push(new Enemy());
                }

                if (Math.random() < 0.005) {
                    powerUps.push(new PowerUp());
                }

                enemies = enemies.filter(enemy => {
                    enemy.update();
                    if (player.collision(enemy)) {
                        gameOver();
                        return false;
                    }
                    return enemy.x > -enemy.size;
                });

                powerUps = powerUps.filter(powerUp => {
                    powerUp.update();
                    if (player.collision(powerUp)) {
                        player.powerUp = powerUp.emoji;
                        player.powerUpTimer = 300;
                        return false;
                    }
                    return powerUp.x > -powerUp.size;
                });

                score++;

                if (score % 1000 === 0) {
                    level++;
                    if (level % 10 === 0) {
                        isBossLevel = true;
                        boss = new Boss();
                    }
                }
            } else {
                const bossAttack = boss.update();
                if (bossAttack) {
                    if (Array.isArray(bossAttack)) {
                        enemies.push(...bossAttack);
                    } else {
                        enemies.push(bossAttack);
                    }
                }

                if (player.collision(boss)) {
                    gameOver();
                }

                if (boss.health <= 0) {
                    isBossLevel = false;
                    boss = null;
                    score += 1000;
                }
            }

            if (fuel < 100) {
                fuel += 0.1;
            }
        }

        function draw() {
            // Create gradient background
            let gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, "#87CEEB");  // Sky Blue
            gradient.addColorStop(1, "#E0F6FF");  // Light Blue
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            player.draw();
            enemies.forEach(enemy => enemy.draw());
            powerUps.forEach(powerUp => powerUp.draw());

            if (isBossLevel && boss) {
                boss.draw();
            }

            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);
            ctx.fillText(`Level: ${level}`, 10, 60);
            ctx.fillText(`Fuel: ${Math.round(fuel)}`, 10, 90);

            if (player.powerUp) {
                ctx.fillText(`Power-up: ${player.powerUp}`, 10, 120);
            }
        }

        function gameLoop() {
            if (isGameRunning) {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        function gameOver() {
            isGameRunning = false;
            gameOverScreen.style.display = 'block';
            finalScoreSpan.textContent = score;
            if (score > highScore) {
                highScore = score;
                safeSetItem('highScore', highScore.toString());
            }
            highScoreSpan.textContent = highScore;
        }

        function handleInput(e) {
            e.preventDefault();
            isJetpackActive = true;
        }

        function handleInputEnd(e) {
            e.preventDefault();
            isJetpackActive = false;
            if (player.powerUp) {
                const projectile = player.shoot();
                if (projectile) {
                    enemies.push(projectile);
                }
            }
        }

        function shareScore(platform) {
            const text = `I scored ${score} points in Jetpack Emoji Adventure! Can you beat my score?`;
            const url = encodeURIComponent(window.location.href);
            let shareUrl;

            if (platform === 'twitter') {
                shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}`;
            } else if (platform === 'facebook') {
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${encodeURIComponent(text)}`;
            }

            window.open(shareUrl, '_blank');
        }

        canvas.addEventListener('mousedown', handleInput);
        canvas.addEventListener('mouseup', handleInputEnd);
        canvas.addEventListener('touchstart', handleInput);
        canvas.addEventListener('touchend', handleInputEnd);

        restartButton.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            init();
            isGameRunning = true;
            requestAnimationFrame(gameLoop);
        });

        startButton.addEventListener('click', () => {
            startScreen.style.display = 'none';
            init();
            isGameRunning = true;
            requestAnimationFrame(gameLoop);
        });

        // Show start screen
        startScreen.style.display = 'block';
    </script>
</body>
</html>
